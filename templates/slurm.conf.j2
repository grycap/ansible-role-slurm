# slurm.conf file generated by configurator.html.
# Put this file on all nodes of your cluster.
# See the slurm.conf man page for more information.
#
ControlMachine={{slurm_server_name}}

{% for key, value in slurm_conf_options.items() %}
{{key}}={{value}}
{% endfor %}

#
#
# COMPUTE NODES

{% set gres = "" %}
{% if slurm_wn_gres != "" %}
  {%- set gres = "Gres=%s" % slurm_wn_gres -%}
{% endif %}

{% if slurm_wn_gres_tpes != "" %}
GresTypes={{ slurm_wn_gres_tpes }}
{% endif %}

{% if slurm_wn_nodenames != [] %}

NodeName={{ slurm_wn_nodenames | join(",") }} CPUs={{ slurm_wn_cpus }} {{ 'RealMemory = %s' % slurm_wn_mem if slurm_wn_mem|int > 0 else '' }} {{ gres }} State=UNKNOWN
PartitionName=debug Nodes={{ slurm_wn_nodenames | join(",") }} Default=YES MaxTime=INFINITE State=UP

{% elif slurm_wn_ips != [] %}

{% set nodes = [max_number_of_nodes, slurm_wn_ips|length]|max %}

# using slurm_wn_ips
NodeName={{slurm_vnode_prefix}}[1-{{slurm_wn_ips|length}}] CPUs={{slurm_wn_cpus}} {{ 'RealMemory = %s' % slurm_wn_mem if slurm_wn_mem|int > 0 else '' }} {{ gres }} State=UNKNOWN
PartitionName=debug Nodes={{slurm_vnode_prefix}}[1-{{slurm_wn_ips|length}}] Default=YES MaxTime=INFINITE State=UP

{% else %}

NodeName={{slurm_vnode_prefix}}[1-{{max_number_of_nodes}}] CPUs={{slurm_wn_cpus}} {{ 'RealMemory = %s' % slurm_wn_mem if slurm_wn_mem|int > 0 else '' }} {{ gres }} State=UNKNOWN
PartitionName=debug Nodes={{slurm_vnode_prefix}}[1-{{max_number_of_nodes}}] Default=YES MaxTime=INFINITE State=UP

{% endif %}

