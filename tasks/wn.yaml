---
  - service: name=firewalld state=stopped
    when: ansible_os_family == "RedHat" and ansible_distribution_major_version|int >= 7
    ignore_errors: yes

  - set_fact: slurm_conf_filename=/usr/local/etc/slurm.conf
    when: ansible_os_family == "Debian"

  - set_fact: slurm_conf_filename=/etc/slurm/slurm.conf
    when: ansible_os_family == "Debian"

  - name: Wait for master
    wait_for:
      path: "{{ slurm_conf_filename }}"
    delegate_to: "{{slurm_server_name}}"
    when: TEST is defined

  - name: copy slurm.conf file from the frontend
    copy: src={{ slurm_conf_filename }} dest={{ slurm_conf_filename }}

    # start SLURM daemon
  - name: Start Slurm Daemon
    command: slurmd

  - name: Reconfigure SLURM
    command: scontrol reconfigure

  - name: allow the slurm user to acces the slurm logs
    file: path=/tmp/slurmd.log mode=0644
