---
- name: Converge
  hosts: all
  gather_facts: false
  vars: 
    ansible_python_interpreter: /usr/bin/python

  pre_tasks:
    - name: Link python
      raw: ls /usr/bin/python || { ls /usr/bin/python2 && ln -s /usr/bin/python2 /usr/bin/python; } || { ls /usr/bin/python3 && ln -s /usr/bin/python3 /usr/bin/python; }
      changed_when: false

    - setup: 

  roles:
    - role: grycap.slurm
      slurm_wn_cpus: 2
      slurm_wn_mem: 1048576
      slurm_wn_gres: "gpu:tesla:2"
      slurm_server_name: slurmserver
      slurm_wn_ips: "{{ groups['wn'] | map('extract', hostvars,'facter_ipaddress') | list }}"
      slurm_vnode_prefix: vnode-
      max_number_of_nodes: 1
      drmaa_lib_install: true
      drmaa_lib_version: 1.1.4
      slurm_version: 23.11.11
      add_extra_hosts: false
      slurm_dbd: true
